<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laporan Infaq Digital - Musholla Wakaf Annur</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #f8fafc; 
            color: #0f172a;
        }
        .gradient-blue { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); }
        .pin-input::-webkit-outer-spin-button, .pin-input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        .shadow-custom { box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.05); }
        .wifi-pulse { animation: wifi-blink 1.5s infinite; }
        @keyframes wifi-blink {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.4; transform: scale(1.1); }
            100% { opacity: 1; transform: scale(1); }
        }
    </style>
</head>
<body class="p-4 md:p-6 lg:p-8 bg-[#f8fafc]">

<div id="app" class="max-w-7xl mx-auto space-y-4">
<header class="bg-[#166534] text-white p-4 md:p-6 rounded-[1.5rem] flex justify-between items-center shadow-lg border-b-4 border-[#14532d]">
<div>
<h1 class="font-black text-base md:text-xl tracking-tight uppercase">Musholla Wakaf Annur</h1>
<p class="text-[9px] md:text-[11px] text-[#4ade80] font-black tracking-[0.3em] uppercase">Laporan Infaq Digital System</p>
</div>
<div class="bg-[#14532d] px-4 py-1.5 rounded-full text-[10px] md:text-xs font-black uppercase tracking-wider border border-white/5 shadow-inner">
<span id="currentDate"></span>
</div>
</header>

<div class="gradient-blue p-8 md:p-12 rounded-[2.5rem] text-white text-center shadow-2xl shadow-blue-100 relative overflow-hidden">
<p class="text-[10px] md:text-xs font-black uppercase tracking-[0.4em] mb-2">Saldo Infaq Saat Ini</p>
<h2 class="text-3xl md:text-5xl font-black tracking-tighter" id="totalBalance">Rp 0</h2>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
<div class="bg-white p-6 md:p-8 rounded-[2rem] border-l-[10px] border-[#10b981] shadow-custom">
<p class="text-[10px] font-black text-gray-400 uppercase tracking-widest mb-1">Total Pemasukan</p>
<p class="text-xl md:text-3xl font-black text-[#10b981]" id="totalIncome">Rp 0</p>
</div>
<div class="bg-white p-6 md:p-8 rounded-[2rem] border-l-[10px] border-[#ef4444] shadow-custom">
<p class="text-[10px] font-black text-gray-400 uppercase tracking-widest mb-1">Total Pengeluaran</p>
<p class="text-xl md:text-3xl font-black text-[#ef4444]" id="totalExpense">Rp 0</p>
</div>
</div>

<div class="bg-white p-6 md:p-10 rounded-[2.5rem] shadow-custom border border-gray-50 space-y-6">
<h3 class="font-black text-base md:text-xl uppercase tracking-widest text-[#166534]">Laporan Mutasi Infaq</h3>
<div class="overflow-x-auto">
<table class="w-full text-left min-w-[800px]">
<thead>
<tr>
<th>TGL</th>
<th>KETERANGAN</th>
<th class="text-right">MASUK</th>
<th class="text-right">KELUAR</th>
</tr>
</thead>
<tbody id="transactionList"></tbody>
</table>
</div>
</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
import { getFirestore, collection, addDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

const firebaseConfig = JSON.parse(__firebase_config);
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const appId = typeof __app_id !== 'undefined' ? __app_id : 'annur-digital-v3';

let transactions = [];

function formatRupiah(num) {
return "Rp " + new Intl.NumberFormat('id-ID').format(num);
}

function updateUI() {
let totalIn = 0;
let totalOut = 0;
const listEl = document.getElementById('transactionList');
listEl.innerHTML = "";

transactions.forEach(tx => {
if (tx.category === 'MASUK') totalIn += tx.amount;
else totalOut += tx.amount;

listEl.innerHTML += `
<tr>
<td>${tx.date.split('-').reverse().join('/')}</td>
<td>${tx.description}</td>
<td class="text-right text-green-600">${tx.category==='MASUK'?formatRupiah(tx.amount):'-'}</td>
<td class="text-right text-red-600">${tx.category==='KELUAR'?formatRupiah(tx.amount):'-'}</td>
</tr>`;
});

document.getElementById('totalBalance').innerText = formatRupiah(totalIn-totalOut);
document.getElementById('totalIncome').innerText = formatRupiah(totalIn);
document.getElementById('totalExpense').innerText = formatRupiah(totalOut);
}

async function init() {

const today = new Date();
document.getElementById('currentDate').innerText =
today.getDate()+" "+["JAN","FEB","MAR","APR","MEI","JUN","JUL","AGU","SEP","OKT","NOV","DES"][today.getMonth()]+" "+today.getFullYear();

await signInAnonymously(auth);

/* ================================
   TAMBAHAN SALDO AWAL OTOMATIS
================================ */

const colRef = collection(db,'artifacts',appId,'public','data','transactions');

onSnapshot(colRef, async (snap) => {
transactions = snap.docs.map(doc=>({id:doc.id,...doc.data()}));

const sudahAda = transactions.some(t=>t.description==="SALDO INFAQ AWAL");

if(!sudahAda){
await addDoc(colRef,{
date:"2025-10-23",
description:"SALDO INFAQ AWAL",
category:"MASUK",
amount:1000000,
createdAt:Date.now(),
updatedAt:Date.now()
});
return;
}

updateUI();
});

}

init();
</script>

</body>
</html>
